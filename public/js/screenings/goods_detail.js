define(function(require){function t(){o(function(){var t=[],a=$("#goods"),e={},o=$("#transmit-type .type.on");e.transmitType=o.attr("data-transmitType");var i=o.attr("data-favPrice"),s=parseInt(a.attr("data-discountPrice"))+parseInt(i);e.favPrice=i,e.subTotal=s;var r=JSON.parse($("#locals_address").val());if("sampling_home"==o.attr("data-transmitType")){var n=$("#area .option.active").data("area");r.push(n)}e.address=JSON.stringify(r),e.goodsId=a.attr("data-id"),e.imgUrl=a.attr("data-imgUrl"),e.goodsName=a.attr("data-goodsName"),e.discountPrice=a.attr("data-discountPrice"),e.hospital=$("#hospital").val(),t.push(e),$("#submitForm input[name=items]").val(JSON.stringify(t)),$("#submitForm input[name=totalPrice]").val(s),$("#submitForm").submit()})}function a(t){r.SendAjax({url:t.url,param:t.param,method:"GET",tipText:"获取地址",callback:function(a){for(var e=a.data,o=[],i=0;i<e.length;i++){var s={};s.id=e[i].id,s.name=e[i].name,s.level=e[i].level,0==i?o.push('<li class="option active" data-area='+JSON.stringify(s)+">"+s.name+"</li>"):o.push('<li class="option" data-area='+JSON.stringify(s)+">"+s.name+"</li>")}$("#"+t.id+" .options").html(o.join("")),e.length<=0?$("#"+t.id+" .selected .text").html("暂无区域"):$("#"+t.id+" .selected .text").html(e[0].name),t.fun&&t.fun()}})}function e(){o(function(){var t=$("#transmit-type .type.on"),a=t.attr("data-value"),e=JSON.parse($("#locals_address").val());if("sampling_home"==t.attr("data-transmitType")){var o=$("#area .option.active").data("area");e.push(o)}var i=$("#goods").attr("data-id"),n={address:JSON.stringify(e),transmit_type:a,goodsId:i,hospital:$("#hospital").val()};r.SendAjax({url:"/trade/cart/addItem",param:n,method:"POST",tipText:"加入购物车",callback:function(t){new r.MsgShow({delayTime:2e3,title:'<i class="icon"></i>加入购物车成功!',otherBox:"successBox"}).hideMsg();s.cartCoutAddOne()}})})}function o(t){s.CheckLogin(function(){if(!i())return!1;var a=$("#transmit-type .type.on");return 0==a.length?($(".type-box").addClass("unchoose"),!1):void(t&&t())})}function i(){var t,a;try{t=JSON.parse($("#locals_address").val()),a=JSON.parse($("#fit_hospital").val())}catch(e){return!1}for(var o=t[1].categoryId,i=0;i<a.length;i++){var s=a[i];if(s.city==o){$("#hospitalName").text(s.hospitalName);var r={hospitalCode:s.hospitalCode,hospitalName:s.hospitalName};return $("#hospital").val(JSON.stringify(r)),!0}}return $(".submitBox button").addClass("disabled"),$(".hospital-tip").removeClass("none"),!1}var s=(require("../config"),require("../login")),r=require("../libs/utils.js");require("touchslider"),$(function(){require("../imgAuto"),i()&&($("#addCartBtn").on("click",function(){e()}),$("#toOrder").on("click",function(){t()}));var o=$(".service_type span"),s=o.length,r=o.parents(".service_type_wrapper");1==s?r.addClass("service_type_one"):2==s?r.addClass("service_type_two"):r.addClass("service_type_three"),$(".goods_detail .tab span").on("click",function(){var t=0,a=$(".topBar").height(),e=$(".goods_detail .tab"),o=e.height(),i=a+o,s=$(this),r=s.data("href-id");t=$("#"+r).offset().top-i,"content-detail"==r&&(t=$("#"+r).offset().top-i),$("html,body").animate({scrollTop:t},1e3)});var n=JSON.parse($("#locals_address").val()),d=$("#transmit-type .type"),l=!0;d.each(function(t,e){var o=$(e);o.on("click",function(){d.removeClass("on"),o.addClass("on"),$(".type-box").removeClass("unchoose");var t=o.attr("data-transmitType");if("sampling_home"==t){if($("#area").removeClass("none"),l){var e=n[1].categoryId;a({id:"area",url:"/dic/list/parentId",param:{activeState:1,parentId:e}}),l=!1}}else $("#area").addClass("none")})}),$(".type-box .box-header .close").on("click",function(){$(".type-box").removeClass("unchoose")}),$(".slideBox").touchSlider({container:this,duration:350,delay:3e3,margin:5,mouseTouch:!0,namespace:"touchslider",next:".next",pagination:".tit span",heightType:!0,currentClass:"on",prev:".prev",autoplay:!1,viewport:".touchslider-viewport"})}),window.onload=function(){var t=$(".goods_detail #tab");t.attr("data-orign-top",t.offset().top);var a=t.closest(".wrapper").width();$(document).scroll(function(){var t=$(".topBar").height(),e=$(".goods_detail #tab");$(document).scrollTop()+t>e.attr("data-orign-top")?(e.css("position","fixed").css({top:t+"px",width:a}),$("#tab-copy").removeClass("none")):(e.css("position","static").css("width",a+"px"),$("#tab-copy").addClass("none"))})}});