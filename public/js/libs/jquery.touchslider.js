!function(t){"function"==typeof define&&define.amd&&define(["jquery"],t),"function"==typeof define?define(["jquery"],function(){return console.log("CommonJS"),t(jQuery,void 0)}):t(window.jQuery||window.Zepto)}(function($,t){window.touchSlider=function(e){function n(t){x.removeClass(e.currentClass).eq(t).addClass(e.currentClass)}function i(e,n){var i=d.current;i!==e&&(e=e!==t?e:i+1,C.to(e,{complete:n}))}function o(t){C.to(d.current+1,{dirX:1,complete:t})}function r(t){C.to(d.current-1,{dirX:-1,complete:t})}function a(){X&&u()}function u(){return X=!0,W||(clearTimeout(k),k=setTimeout(function(){C.moving||W||o()},e.delay)),e.container}function s(){return clearTimeout(k),X=!1,e.container}function c(){var t,e,n,i,o,r,a,u,s,c,h,l,d,w=$(document),y=!1,x=function(u){if(!(u.which>1)){if(y&&w.triggerHandler(v+"."+f),y=!0,e=!1,t=u.timeStamp,a=l=0,n=[0,0,0,t],u.originalEvent.touches)return void w.one(p,S);u.preventDefault(),o=r=u.pageX,c=h=u.pageY,s=M[0].offsetLeft,i=[0,0,0,o],w.bind(g,q),w.one(v+"."+f,k),C.moveStart(u)}},S=function(t){1===t.originalEvent.touches.length&&(o=r=t.pageX=t.originalEvent.touches[0].pageX,c=h=t.pageY=t.originalEvent.touches[0].pageY,u=d=0,s=new WebKitCSSMatrix(window.getComputedStyle(M[0]).webkitTransform).e,i=[0,0,0,o],w.bind(g,q),w.one(v,k),C.moveStart(t))},q=function(t){var o,s;if(t.originalEvent.touches&&m){if(1!==t.originalEvent.touches.length)return;if(o=t.pageX=t.originalEvent.touches[0].pageX,s=t.pageY=t.originalEvent.touches[0].pageY,u+=Math.abs(o-r),d+=Math.abs(s-h),Math.abs(u-d)>50){var c=u;u=Math.min(100,Math.max(0,u-d)),d=Math.min(100,Math.max(0,d-c))}if(o===r)return;e||(u>d?(t.preventDefault(),e=!0):k(t))}else{if(o=t.pageX,s=t.pageY,o===r)return;/msie/.test(navigator.userAgent.toLowerCase())&&t.preventDefault()}a+=Math.abs(o-r),l+=Math.abs(s-h),n.shift(),n.push(t.timeStamp),i.shift(),i.push(o),C.move(t,r),r=o,h=s},k=function(e){y=!1,e.originalEvent&&!e.originalEvent.touches||(e.pageX=r,e.pageY=h),w.unbind(g,q);for(var o=n.length,u=0,s=0;--o>0;)if(n[o-1]){var c=i[o]-i[o-1];u+=Math.abs(c)/(n[o]-n[o-1]),0!==c&&(s=c>0?-1:1)}u/=n.length,C.moveEnd(e,u,s,t,a,l),T=!1,a+l>4&&b.one("click",function(t){t.preventDefault()})};b.bind(p,x)}e=e||{};var f=e.namespace||"touchslider",h=$(e.container);if(1!==h.length)return void h.each(function(){touchSlider({container:this})});var l=!!navigator.userAgent.match(/AppleWebKit.*Mobile.*/),e=$.extend({autoplay:!1,delay:3e3,margin:5,viewport:"."+f+"-viewport",prev:"."+f+"-prev",next:"."+f+"-next",pagination:"."+f+"-nav-item",currentClass:f+"-nav-item-current",duration:350,mouseTouch:!0,mobile:l},e),d={current:0,step:i,next:o,prev:r,start:u,stop:s},m="ontouchstart"in window&&"WebKitCSSMatrix"in window,p="touchstart",g="touchmove",v="touchend",b=$(e.viewport,h),w=b.width(),M=e.scroller?$(e.scroller,h):b.children(),y=M.children(),x=$(e.pagination,h);if("absolute"!==M.css("position")){var S=b.children().children().height();console.log(b),console.log(S),b.css({height:S,position:"relative"}),M.css({position:"absolute",left:0,height:S,width:1e5})}m||(p="mousedown",g="mousemove",v="mouseup"),y.css({position:"absolute",width:w});var q=m?function(e,n,i){return n===t?new WebKitCSSMatrix(getComputedStyle(e.jquery?e[0]:e).webkitTransform).e:void e.css({webkitTransitionDuration:i?i+"ms":"0",webkitTransform:function(t){return"translate3d("+("number"==typeof n?n:n.call(this,t))+"px,0,0)"}})}:function(e,n){return n===t?parseInt((e.jquery?e[0]:e).style.left,10):void e.css("left",n)};m&&y.css({webkitTransitionProperty:"-webkit-transform",webkitTransitionTimingFunction:"cubic-bezier(0,0,0.25,1)"}),q(y.not(y[0]),1e4),q(y.eq(0),0);var C=function(){var i=[0],o=[0],r=$.noop;return{moving:!1,init:function(){M.bind("webkitTransitionEnd",function(){r()})},to:function(u,s){s=s||{},u>=y.length?u=0:0>u&&(u=y.length-1);var c=e.duration,f=y.eq(u),h=$.inArray(u,i),l=0;if(M.stop(),C.moving=!0,clearTimeout(k),-1!==h)l=o[h];else{var p,g=y.index(f);if(h=t,-1===s.dirX)o.unshift(0),i.unshift(g);else if(1===s.dirX)o.push(0),i.push(g);else{for(p=i.length-1;p>=0;p--)if(i[p]<g){o.splice(p+1,0,0),i.splice(p+1,0,g),h=0;break}h===t&&(o.unshift(o),i.unshift(g))}if(h=$.inArray(g,i),0===h)l=o[1]-(f.outerWidth()+e.margin),q(f,l),o[h]=l;else if(h===i.length-1)l=o[h-1]+y.eq(i[h-1]).outerWidth()+e.margin,q(f,l),o[h]=l;else{var v=f.outerWidth();f.css("opacity",0),l=o[h+1]-Math.round((v+e.margin)/2),o[h]=l,q(f,l);var b=l,w=i.length;for(p=h-1;p>=0;p--)b-=y.eq(i[p]).outerWidth()+e.margin,o[p]=b;var x=l;for(p=h+1;w>p;p++)x+=y.eq(i[p]).outerWidth()+e.margin,o[p]=x;for(p=0;w>p;p++)y.eq(i[p]).animate({left:o[p]},{duration:c,queue:!1,complete:function(){f.is(this)&&f.animate({opacity:1},c)}})}}s.pxInMs&&(c=Math.min(Math.max(Math.round(Math.abs(q(M))/s.pxInMs),100),c)),r=function(){q(y.not(f),-1e4),i=[y.index(f)],o=[l],s.complete&&s.complete(),C.moving=!1,a()},m?q(M,-l,c):M.animate({left:-l},{duration:c,queue:!1,complete:r}),d.current=u,n(u)},stop:function(){m?q(M,q(M)):M.stop()},moveStart:function(t){C.moving=!0,clearTimeout(k),M.stop(),C.startPageX=t.pageX;var e,n=q(M);C.leftCount=n,0===i[0]?o[0]+n>0&&(C.leftCount=n+3*(o[0]+n)):i[i.length-1]===y.length-1&&(e=o[i.length-1]+n,0>e&&(C.leftCount=n+3*e))},move:function(t,n){var r,a,u,s=t.pageX-n,c=q(M),f=y.eq(i[0]),h=i.length-1,l=y.eq(i[h]);if(C.leftCount+=s,s>0)for(;0!==i[0]&&c+o[0]+s>e.margin;)r=y.eq(i[0]-1),a=o[0]-r.outerWidth()-e.margin,q(r,a),o.unshift(a),i.unshift(i[0]-1),h++,f=r;if((s>0&&c+o[0]+s>0||0>s&&c+o[0]>0)&&0===i[0]&&(u=Math.min(Math.round((C.leftCount+o[0])/4),b.innerWidth()/2),s=u-(c+o[0])),0>s)for(;!l.is(y.last())&&c+o[h]+s+l.outerWidth()+e.margin<b.innerWidth();)r=y.eq(i[h]+1),a=o[h]+l.outerWidth()+e.margin,q(r,a),o.push(a),i.push(i[h++]+1),l=r;(s>0&&c+o[h]<0||0>s&&c+o[h]+s<0)&&l.is(y.last())&&(u=Math.max(Math.round((C.leftCount+o[h])/4),-b.innerWidth()/2),s=u-(c+o[h])),q(M,c+s)},moveEnd:function(t,e,n,r,a,u){var s,c=i.length,f=q(M),h=c-1;if(o[0]+f>0)h=0;else if(o[i.length-1]+f<0);else{s={pxInMs:e};var l,d,m=c-1,p=b.innerWidth();for(l=0;c-1>l;l++)if(d=o[l]+y.eq(i[l]).outerWidth()+f,d>0&&d>p-(o[l+1]+f)){m=l;break}if(T)h=m;else{var g=c-1,v=Math.round(M.offset().left);for(l=0;c>l;l++)if(o[l]+v>t.pageX){g=l-1;break}h=m,m===g&&t.timeStamp-r<1e3&&a+u>.05*Math.sqrt(Math.pow(b.height(),2)+Math.pow(p,2))&&(h=Math.max(0,Math.min(c-1,h+n)))}}h=i[h],C.to(h,s)}}}();if(C.init(),m){var T=!1;M.bind("webkitTransitionStart",function(){T=!0}),M.bind("webkitTransitionEnd",function(){T=!1})}var k,W=!1,X=!1;b.hover(function(){clearTimeout(k),W=!0},function(){W=!1,a()}),x.click(function(){i(x.index(this))}),$(e.prev,h).click(function(){r()}),$(e.next,h).click(function(){o()}),e.mouseTouch&&l&&c(),e.autoplay&&u(),h.data(f,d)},$.fn.touchSlider=function(t){return t=t||{},t.container=this,touchSlider(t),this}});