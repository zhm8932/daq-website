webpackJsonp([19],{0:function(t,o,a){a(205),t.exports=a(7)},205:function(t,o,a){var e;e=function(t,o,e){function n(t){var o=$(".goods-list tbody tr"),a=[],e=(o.eq(0).attr("data-goodsid"),[]);o.each(function(t,o){var n=$(o),d={};d.goodsId=n.attr("data-goodsid"),n.attr("data-id")&&"undefined"!=n.attr("data-id")&&e.push(n.attr("data-id")),d.transmitType=n.attr("data-transmitType");for(var i=JSON.parse(n.attr("data-address")),r="",c=0;c<i.length;c++)r+=i[c].name;d.address=r,d.hospital=JSON.parse(n.attr("data-hospital")),d.amount=1,a.push(d)});var d=$("#cityId").val(),i=$("#coupon-table .radio.checked").closest("tr").attr("data-id")||"",r=$("#actualTotal .price").html().substr(1);if(parseFloat(r)<=0)return u.ShowComfirmDialog({tipText:"订单金额必须大于0.00元",noConfirmBtn:!0}),!1;var c={cityId:d,couponCodeId:i,goodsPropertyList:a};t.addClass("disabled").off("click");var s=$("#orderToken").val();u.SendAjax({url:"/trade/order/create",param:{orderPlaceDTO:JSON.stringify(c),ids:JSON.stringify(e),orderToken:s},method:"POST",tipText:"提交订单",callback:function(t){l.getCartCount(function(){window.location.href="/trade/order/orderSuccess?id="+t.id})},errorFun:function(){t.removeClass("disabled").on("click",function(){n(t)})}})}function d(t){l.CheckLogin(function(){var o=$("#coupon-code").val().trim();return o?(t.off("click"),void u.SendAjax({url:"/users/coupon/addByInvite",param:{inviteCode:o},method:"POST",tipText:"添加优惠券",callback:function(o){u.ShowComfirmDialog({tipText:"领取成功!",noConfirmBtn:!0}),$("#coupon-code").val("");var a=$("#coupon-table tbody tr"),e=c(o.data),n=$(e.trStr);e.isfit?(a.eq(0).before(n),n.find(".coupon-radio").on("click",function(){i($(this))})):a.eq(f).before(n),$("#coupon-table tbody tr.no-record").remove(),t.on("click",function(){d($(this))})},errorFun:function(){t.on("click",function(){d($(this))})}})):(u.ShowComfirmDialog({tipText:"请输入优惠码",noConfirmBtn:!0}),!1)})}function i(t){u.CheckRadio(t,".coupon-radio",function(){var o=parseInt($("#discountPriceTotal").val()),a=parseInt($("#servicePriceTotal").val()),e=parseInt($("#goodsTotalPrice").val());if(t.hasClass("checked")){var n,d,i,r,c,s=t.closest("tr"),u=s.attr("data-ftype");"cash"==u?(n=i=parseInt(s.attr("data-faceValue")),d=o-i>0?o-i+a:0+a):"discount"==u&&(r=parseFloat(s.attr("data-discount")),c=parseFloat(s.attr("data-mostDeduction")),n=(o*(1-.1*r)).toFixed(0),n=n>=c?c:n,d=o-n+a),$("#actualTotal .price").html("￥"+(d/100).toFixed(2)),$("#actualTotal .fav").html("(已优惠￥"+(n/100).toFixed(2)+")")}else $("#actualTotal .price").html("￥"+(e/100).toFixed(2)),$("#actualTotal .fav").html("(已优惠￥0.00)")})}function r(){l.CheckLogin(function(){var t={pageSize:100,useState:1,pageIndex:1};u.SendAjax({url:"/users/coupon/list",param:t,method:"GET",tipText:"获取优惠券",callback:function(t){var o=t.data,a=[],e=[];if(0===o.length)$("#coupon-table tbody").html('<tr class="text-center no-record"><td colspan="5">暂无优惠券记录</td></tr>');else{for(var n=0;n<o.length;n++){var d=c(o[n]);d.isfit?a.push(d.trStr):e.push(d.trStr)}$("#coupon-table tbody").html(a.join("")+e.join(""))}$(".coupon-radio").off("click").on("click",function(){i($(this))})},errorFun:function(t){}})})}function c(t){var o,a,e,n=[],d=parseInt($("#discountPriceTotal").val()),i=$("#currentHospitalCode").val(),r=JSON.parse(t.fitArea),c=[],l=[],h=!1,m=(new Date).getTime();for(e=0;e<r.length;e++)c.push(r[e].hospitalName),l.push(r[e].hospitalCode);return"cash"==t.ftype?(o=parseFloat(t.faceValue),a=parseFloat(t.enoughMoney),d>=a&&s(i,l)&&m>=t.beginTime&&m<=t.endTime?(n.push('<tr data-id="'+t.couponCodeId+'" data-faceValue="'+o+'" data-enoughMoney="'+a+'" data-ftype="'+t.ftype+'"><td><span class="radio coupon-radio"></span></td>'),h=!0):(n.push('<tr data-id="'+t.couponCodeId+'" data-faceValue="'+o+'" data-enoughMoney="'+a+'" data-ftype="'+t.ftype+'"><td><span class="radio coupon-radio disabled"></span></td>'),h=!1),n.push("<td>"+(parseFloat(t.faceValue)/100).toFixed(2)+"元</td>"),0==a?n.push("<td>无门槛</td>"):n.push("<td>满"+(a/100).toFixed(2)+"元使用</td>")):"discount"==t.ftype&&(s(i,l)&&m>=t.beginTime&&m<=t.endTime?(n.push('<tr data-id="'+t.couponCodeId+'" data-discount="'+t.discount+'" data-mostDeduction="'+t.mostDeduction+'" data-ftype="'+t.ftype+'"><td><span class="radio coupon-radio"></span></td>'),h=!0):(n.push('<tr data-id="'+t.couponCodeId+'" data-discount="'+t.discount+'" data-mostDeduction="'+t.mostDeduction+'" data-ftype="'+t.ftype+'"><td><span class="radio coupon-radio disabled"></span></td>'),h=!1),n.push("<td>"+t.discount+"折</td>"),n.push("<td>最多可抵"+(parseFloat(t.mostDeduction)/100).toFixed(2)+"元</td>")),n.push("<td>限"+c.join("、")+"</td>"),n.push("<td >"+u.GetLoacalDateString(t.beginTime)+" 至 "+u.GetLoacalDateString(t.endTime)+"</td></tr>"),h?f++:p++,{trStr:n.join(""),isfit:h}}function s(t,o){for(var a=0;a<o.length;a++)if(t===o[a])return!0;return!1}var u=a(4),l=a(9),p=0,f=0;$(function(){$(".add-coupon").on("click",function(){d($(this))}),$("#submit-btn").on("click",function(){n($(this))}),$(".coupon-trigger").on("click",function(){var t=$(this);if(t.hasClass("opend"))t.removeClass("opend"),$(".coupon-box").hide();else{t.addClass("opend"),$(".coupon-box").show();var o=$(".coupon-box").data("load");"first"==o&&($(".coupon-box").data("load","non-first"),r())}})})}.call(o,a,o,t),!(void 0!==e&&(t.exports=e))}});