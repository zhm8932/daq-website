define(function(require,exports,module){function t(t,o){var a={pageSize:100,useState:o,pageIndex:1};n.SendAjax({url:"/users/coupon/list",param:a,method:"GET",tipText:"获取优惠券",callback:function(o){var n=o.data,a=[];if(n.length<=0)$("#coupon-table tbody").html('<tr class="text-center"><td colspan="5">暂无优惠券记录</td></tr>');else{for(var i=0;i<n.length;i++)a=a.concat(e(n[i]));$("#coupon-table tbody").html(a.join(""))}$(".coupon-state li.on").removeClass("on"),t.addClass("on")},errorFun:function(t){}})}function o(t){var a=$("#coupon-code").val().trim();return a?(t.addClass("disabled").off("click"),void n.SendAjax({url:"/users/coupon/addByInvite",param:{inviteCode:a},method:"POST",tipText:"添加优惠券",callback:function(a){n.ShowComfirmDialog({tipText:"领取成功!",noConfirmBtn:!0}),$("#coupon-code").val("");var i=$(e(a.data).join(""));$("#coupon-table tbody tr").eq(0).before(i),$("#coupon-table tbody tr.no-record").remove(),t.removeClass("disabled").on("click",function(){o(t)})},errorFun:function(){t.removeClass("disabled").on("click",function(){o(t)})}})):(n.ShowComfirmDialog({tipText:"请输入优惠码",noConfirmBtn:!0}),!1)}function e(t){var o,e,a=[],i=JSON.parse(t.fitArea),c=[],s=[];for(e=0;e<i.length;e++)c.push(i[e].hospitalName),s.push(i[e].hospitalCode);return"cash"==t.ftype?(o=parseInt(t.enoughMoney),a.push("<tr>"),a.push("<td>"+(parseFloat(t.faceValue)/100).toFixed(2)+"元</td>"),0==o?a.push("<td>无门槛</td>"):a.push("<td>满"+(o/100).toFixed(2)+"元使用</td>")):"discount"==t.ftype&&(a.push("<tr>"),a.push("<td>"+t.discount+"折</td>"),a.push("<td>最多可抵"+(parseFloat(t.mostDeduction)/100).toFixed(2)+"元</td>")),a.push("<td>限"+c.join("、")+"</td>"),a.push("<td >"+n.GetLoacalDateString(t.beginTime)+" 至 "+n.GetLoacalDateString(t.endTime)+"</td></tr>"),a}var n=require("../libs/utils.js");require("../login.js");$(".date").each(function(t,o){var e=$(o),a=parseInt(e.html()),i=n.GetLoacalDateString(a);e.html(i)}),$(".add-coupon").on("click",function(){o($(this))}),$(".coupon-state .unuse").on("click",function(){t($(this),"1")}),$(".coupon-state .used").on("click",function(){t($(this),"2")}),$(".coupon-state .overdue").on("click",function(){t($(this),"3")})});