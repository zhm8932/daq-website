extends ../layout

block content
    link(href='/css/users/user.css',rel='styleSheet')
    include ../includes/responsive
    include ../includes/nav
    .positon.wrapper
        |您的位置为：首页<em>#{sep}</em>我的订单
    section.wrapper.userBox.clearfix
        aside.fl
            -var orderStateJSON = {'1':'未支付','2':'已支付','3':'已取消','4':'退款中','5':'已退款'};
            -var sampleJson = JSON.parse(locals_sample);
            div.user-main.text-center
                img(src='/images/doctor.png')
                span.tel.text-sec 15919740039
            ul.left-nav
                li: a.on(href='/users/orders') 我的订单
                li: a(href='/users/bookings') 我的预约
                li: a(href='/users/registers') 我的挂号
                li: a(href='/users/coupons') 我的优惠券
                li: a(href='/users/patients') 就诊人
        .box-right.fr
            each item in data
                -var orderState = item.orderState;
                dl.order(data-id="#{item.id}")
                    dt
                        |订单编号：#{item.id}
                        time.date-time.text-sec #{item.updatedAt}
                    dd
                        .col.goods
                            -var transmitType = '';
                            each goods,index in item.goodsItemDTOs
                                each value,key in JSON.parse(goods.transmitType)
                                    -transmitType = sampleJson[key];
                                .row
                                    span.row-col.goods-detail
                                        img.fl(src='#{goods.imageUrls[0]}')
                                        h5.fr: a(href='#') #{goods.goodsName}
                                    if goods.reservationState == 0
                                        span.row-col.goods-others.text-sec
                                            p 未使用
                                            p #{transmitType}
                                            p.text-stress 密码：#{goods.reservationPwd}
                                        span.row-col.reservation.text-main
                                            p 电话预约
                                            p 400-4557-452
                                    else if goods.reservationState == 1
                                        span.row-col.goods-others.text-sec
                                            p 已使用
                                            p #{transmitType}
                                        span.row-col.reservation.text-sec
                                            p 预约详情
                                    else
                                        span.row-col.goods-others.text-sec
                                            p #{transmitType}
                        .col.order-state.text-sec

                            if orderState == 1
                                p.state-info.bdr-bt.text-stress
                                    |#{orderStateJSON[orderState]}
                            else
                                p.state-info.bdr-bt
                                    |#{orderStateJSON[orderState]}
                            p 总额：￥#{parseInt(item.totalCost)/100}
                            p 商品合计：￥#{parseInt(item.feeMap.goods_price)/100}
                            p 优惠券：-￥
                                if item.feeMap.coupon_fee
                                    |#{parseInt(item.feeMap.coupon_fee)/100}
                                else
                                    |0
                            p 服务优惠：-￥
                                if item.feeMap.service_fee
                                    |#{parseInt(item.feeMap.service_fee)/100}
                                else
                                    | 0

                        .col.operation
                            p: a(href='/trade/order/detail?id=#{item.id}') 订单详情
                            if orderState == 1
                                p: a(href='/trade/order/orderSuccess?id=#{item.id}&totalCost=#{item.totalCost}') 继续支付
                                p: a(href='/trade/order/orderSuccess?id=#{item.id}&totalCost=#{item.totalCost}') 取消订单
                            if orderState == 3 || item.orderState == 4 ||item.orderState == 5
                                p: a(href='/trade/order/orderSuccess?id=#{item.id}&totalCost=#{item.totalCost}') 删除订单




    include ../includes/footer
    script.
        seajs.use('/js/trade/order_list.js')
